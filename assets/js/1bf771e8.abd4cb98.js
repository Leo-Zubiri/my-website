"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4333],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>b});var a=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var i=a.createContext({}),p=function(e){var n=a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},d=function(e){var n=p(e.components);return a.createElement(i.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=p(t),m=o,b=c["".concat(i,".").concat(m)]||c[m]||u[m]||r;return t?a.createElement(b,l(l({ref:n},d),{},{components:t})):a.createElement(b,l({ref:n},d))}));function b(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,l=new Array(r);l[0]=m;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s[c]="string"==typeof e?e:o,l[1]=s;for(var p=2;p<r;p++)l[p]=t[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},96965:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var a=t(87462),o=(t(67294),t(3905));const r={},l="ORM",s={unversionedId:"nodejs/3.2 ORM",id:"nodejs/3.2 ORM",title:"ORM",description:"Object Relational Mapper",source:"@site/docs/nodejs/3.2 ORM.md",sourceDirName:"nodejs",slug:"/nodejs/3.2 ORM",permalink:"/my-website/docs/nodejs/3.2 ORM",draft:!1,editUrl:"https://github.com/Leo-Zubiri/my-website/tree/master/docs/nodejs/3.2 ORM.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"MVC",permalink:"/my-website/docs/nodejs/3.1 MVC"},next:{title:"Autenticaci\xf3n",permalink:"/my-website/docs/nodejs/3.3 Auth"}},i={},p=[{value:"Ventajas",id:"ventajas",level:2},{value:"ORM&#39;s en Node",id:"orms-en-node",level:2},{value:"Sequelize",id:"sequelize",level:2},{value:"Crear variables de entorno para conexi\xf3n",id:"crear-variables-de-entorno-para-conexi\xf3n",level:3},{value:"Modelos",id:"modelos",level:3},{value:"Hooks",id:"hooks",level:3},{value:"Metodos Personalizados Modelo",id:"metodos-personalizados-modelo",level:3},{value:"Autenticar contrase\xf1a",id:"autenticar-contrase\xf1a",level:4}],d={toc:p},c="wrapper";function u(e){let{components:n,...t}=e;return(0,o.kt)(c,(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"orm"},"ORM"),(0,o.kt)("p",null,"Object Relational Mapper"),(0,o.kt)("p",null,"Los datos de una base de datos son representados mediante el paradigma de programaci\xf3n orientada a objetos."),(0,o.kt)("p",null,"Seg\xfan el ORM se siguen sus reglas para la representaci\xf3n de clases y atributos para que posteriormente sean mapeados a la base de datos correspondiente."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"En MVC el ORM tiene relaci\xf3n con los Modelos")),(0,o.kt)("h2",{id:"ventajas"},"Ventajas"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"No escribir c\xf3digo SQL"),(0,o.kt)("li",{parentName:"ul"},"Se utiliza menos c\xf3digo"),(0,o.kt)("li",{parentName:"ul"},"Incrementa la velocidad de desarrollo"),(0,o.kt)("li",{parentName:"ul"},"La mayor\xeda de ORM implementa medidas de seguridad")),(0,o.kt)("h2",{id:"orms-en-node"},"ORM's en Node"),(0,o.kt)("p",null,"Node tiene una gran cantidad de ORM que se instalan como librer\xeda."),(0,o.kt)("p",null,"Algunos ejemplos:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Prisma"),(0,o.kt)("li",{parentName:"ul"},"Sequelize"),(0,o.kt)("li",{parentName:"ul"},"Bookshelf.js"),(0,o.kt)("li",{parentName:"ul"},"TypeORM"),(0,o.kt)("li",{parentName:"ul"},"Mongoose")),(0,o.kt)("h2",{id:"sequelize"},"Sequelize"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"npm i sequelize mysql2")),(0,o.kt)("li",{parentName:"ol"},"Crear base de datos mysql"),(0,o.kt)("li",{parentName:"ol"},"Crear directorio ",(0,o.kt)("inlineCode",{parentName:"li"},"./config/db.js")," en la ra\xedz del proyecto")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./config/db.js"',title:'"./config/db.js"'},"import { Sequelize   } from \"sequelize\";\n\nconst db = new Sequelize(\n    'dbName',\n    'dbUser',\n    'dbPassword',\n    {\n        host: 'localhost',\n        port: 3306,\n        dialect: 'mysql',\n        define: {\n            timestamps: true\n        },\n        pool: {\n            max: 5, // 5 conexiones m\xe1ximas por usuario\n            min: 0,\n            acquire: 30000, // Trata de elaborar una conexi\xf3n en 30 segundos\n            idle: 10000 // 10 segundos para que la conexi\xf3n finalice si ya no hay interacci\xf3n\n        },\n        operatorsAliases: false\n    }\n);\n\nexport default db;\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="index.js"',title:'"index.js"'},"\nimport express from 'express';\nimport db from './config/db.js'\n\n// Crear la app\nconst app = express();\n\n// DB Connection\ntry {\n    await db.authenticate()\n    db.sync() // Crea tablas si no existen\n    console.log('Conexi\xf3n correcta a la base de datos')\n} catch (error) {\n    console.log(error)\n}\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Con esta forma las credenciales para la conexi\xf3n quedan expuestas por lo que se tienen que implementar variables de entorno.")),(0,o.kt)("h3",{id:"crear-variables-de-entorno-para-conexi\xf3n"},"Crear variables de entorno para conexi\xf3n"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"npm i dotenv")),(0,o.kt)("p",null,"Crear ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," en la ra\xedz del proyecto"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title=".env"',title:'".env"'},"DB_NAME=database\nDB_USER=user\nDB_PASS=password\nDB_HOST=localhost\nDB_PORT=3306\n")),(0,o.kt)("p",null,"Importar dotenv y cambiar las variables:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./config/db.js"',title:'"./config/db.js"'},"import { Sequelize   } from \"sequelize\";\n\nimport dotenv from 'dotenv';\ndotenv.config({path:'.env'})\n\nconst db = new Sequelize(\n    process.env.DB_NAME,\n    process.env.DB_USER,\n    process.env.DB_PASS ?? '',\n    {\n        host: process.env.DB_HOST,\n        port: process.env.DB_PORT,\n        dialect: 'mysql',\n        define: {\n            timestamps: true\n        },\n        pool: {\n            max: 5, // 5 conexiones m\xe1ximas por usuario\n            min: 0,\n            acquire: 30000, // Trata de elaborar una conexi\xf3n en 30 segundos\n            idle: 10000 // 10 segundos para que la conexi\xf3n finalice si ya no hay interacci\xf3n\n        },\n        //operatorsAliases: false\n    }\n);\n\nexport default db;\n")),(0,o.kt)("h3",{id:"modelos"},"Modelos"),(0,o.kt)("p",null,"Se crea el directorio ",(0,o.kt)("inlineCode",{parentName:"p"},"./models")," y dentro el ",(0,o.kt)("inlineCode",{parentName:"p"},"NombreModelo.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Usuario.js"',title:'"Usuario.js"'},"import { DataTypes } from 'sequelize'\nimport db from '../config/db.js'\n\nconst Usuario = db.define('users',{\n    name: {\n        type: DataTypes.STRING,\n        allowNull: false\n    },\n    email: {\n        type: DataTypes.STRING,\n        allowNull: false\n    },\n\n    password:{\n        type: DataTypes.STRING,\n        allowNull: false\n    },\n    token: DataTypes.STRING,\n    confirmed: DataTypes.BOOLEAN\n})\n\nexport default Usuario;\n")),(0,o.kt)("h3",{id:"hooks"},"Hooks"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Modelo en sequelize"',title:'"Modelo',en:!0,'sequelize"':!0},"const Modelo = db.define('Modelos',{\n    ...\n},\n{\n    hooks: {\n        beforeCreate: async function(modelo){\n            const salt = await bcrypt.genSalt(10);\n            modelo.password = await bcrypt.hash(modelo.password,salt)\n        }\n    }\n}\n)\n")),(0,o.kt)("h3",{id:"metodos-personalizados-modelo"},"Metodos Personalizados Modelo"),(0,o.kt)("p",null,"Se utilizan prototypes para agregar funciones impl\xedcitas a los objetos."),(0,o.kt)("h4",{id:"autenticar-contrase\xf1a"},"Autenticar contrase\xf1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Modelo Usuario"',title:'"Modelo','Usuario"':!0},"import { DataTypes } from 'sequelize'\nimport bcrypt from 'bcrypt'\nimport db from '../config/db.js'\n\nconst Usuario = db.define('users',{\n    ...\n})\n\n// Metodos personalizados\nUsuario.prototype.verifyPassword = function(password){\n    return bcrypt.compareSync(password, this.password)\n}\n\nexport default Usuario;\n")))}u.isMDXComponent=!0}}]);